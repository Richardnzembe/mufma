{% extends 'base.html' %}

{% block title %}Task Timeline - MUFMA{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div>
        <h1 class="dashboard-title">ðŸ“… Task Timeline</h1>
        <p style="color: var(--text-secondary);">View all your crop and animal activities</p>
    </div>
</div>

<div class="content-wrapper">
    {% if tasks %}
        <div class="timeline">
            {% for task in tasks %}
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div class="timeline-date">{{ task.date|date:"M d, Y - H:i" }}</div>
                        <div class="timeline-title">
                            {{ task.get_activity_type_display }} for
                            {% if task.crop %}
                                <a href="{% url 'farms:crop_detail' task.crop.id %}" style="color: var(--primary-color);">{{ task.crop.name }}</a>
                            {% else %}
                                <a href="{% url 'farms:animal_detail' task.animal.id %}" style="color: var(--primary-color);">{{ task.animal.name }}</a>
                            {% endif %}
                        </div>
                        
                        {% if task.status == 'completed' %}
                            <span class="badge badge-success">{{ task.get_status_display }}</span>
                        {% elif task.is_overdue %}
                            <span class="badge badge-error">Overdue</span>
                        {% else %}
                            <span class="badge badge-warning">{{ task.get_status_display }}</span>
                        {% endif %}
                        
                        {% if task.description %}
                            <p style="margin-top: var(--spacing-sm); color: var(--text-secondary);">{{ task.description }}</p>
                        {% endif %}
                        
                        <div style="margin-top: var(--spacing-md); display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                            {% if task.status == 'pending' %}
                                {% if task.crop %}
                                    <a href="{% url 'farms:complete_task' task.id %}" class="btn btn-accent btn-sm">âœ“ Mark Complete</a>
                                {% else %}
                                    <a href="{% url 'farms:complete_animal_task' task.id %}" class="btn btn-accent btn-sm">âœ“ Mark Complete</a>
                                {% endif %}
                            {% endif %}
                            {% if task.crop %}
                                <a href="{% url 'farms:delete_task' task.id %}" class="btn btn-secondary btn-sm" onclick="return confirm('Are you sure you want to delete this task?')">Delete</a>
                            {% else %}
                                <a href="{% url 'farms:delete_animal_task' task.id %}" class="btn btn-secondary btn-sm" onclick="return confirm('Are you sure you want to delete this task?')">Delete</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            <p style="margin: 0;">No tasks scheduled yet. Add activities to your crops and animals to see them here!</p>
        </div>
    {% endif %}
</div>

<div style="margin-top: var(--spacing-xl);">
    <a href="{% url 'farms:home' %}" class="btn btn-outline">â¬… Back to Dashboard</a>
</div>
{% endblock %}
